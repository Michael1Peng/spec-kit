# 数据流设计 - 模板同步管理

## 模板下载与提取数据流向
```
GitHub API请求 ──→ download_template_from_github ──→ httpx.Client ──→ 模板文件下载
     │                     │                           │                │
     ▼                     ▼                           ▼                ▼
API调用启动            获取release信息             Stream下载          ZIP文件保存
@init命令              @/__init__.py:419           @httpx流式          @临时目录
     │                     │                           │                │
     ▼                     ▼                           ▼                ▼
用户参数解析          release_data解析            进度条显示          extract_template
ai_assistant参数      assets筛选匹配              Progress组件        @zipfile.ZipFile
                                                                      │
                                                                      ▼
项目目录创建 ←─────────────────────────────────────────────── 文件系统操作
     │                                                           │
     ▼                                                           ▼
project_path目录      ←───────── extract_template ←────────── ZIP内容解压
@Path对象创建                   @/__init__.py:520              递归文件复制
```

## 配置文件同步更新数据流向
```
plan.md文件读取 ──→ update_agent_file ──→ agent模板处理 ──→ 配置文件生成
     │                   │                    │               │
     ▼                   ▼                    ▼               ▼
特征分支检测        模板内容替换         Python内嵌脚本     多Agent文件更新
@common.sh         @update-agent-context  @正则表达式处理    CLAUDE/GEMINI/etc
     │                   │                    │               │
     ▼                   ▼                    ▼               ▼
get_feature_paths   grep提取配置信息      内容动态生成       文件系统写入
变量路径解析        Language/Framework    占位符替换         .md文件更新
     │                   │                    │               │
     ▼                   ▼                    ▼               ▼
FEATURE_DIR路径 ──→ 配置参数提取 ──→ 模板变量绑定 ──→ 持久化存储
@specs/$branch     NEW_LANG/FRAMEWORK   [PROJECT_NAME]替换  目标配置文件
```

## 脚本执行控制数据流向
```
Bash命令调用 ──→ subprocess.run ──→ Shell环境执行 ──→ 返回状态码
     │               │                │                │
     ▼               ▼                ▼                ▼
CLI参数解析     进程创建管理      Git操作执行       结果状态处理
@typer.Option   @run_command      branch创建/检出    成功/失败反馈
     │               │                │                │
     ▼               ▼                ▼                ▼
用户交互选择     环境变量传递      文件系统操作       UI状态更新
select_arrows   cwd工作目录       mkdir/cp/chmod     Progress/Rich
     │               │                │                │
     ▼               ▼                ▼                ▼
选项验证处理 ──→ 命令执行链 ──→ 批量文件处理 ──→ 用户反馈显示
@AI_CHOICES     scripts调用链      模板文件复制       console.print
```

## 版本控制集成数据流向
```
Git仓库检测 ──→ init_git_repo ──→ Git命令执行 ──→ 提交记录创建
     │             │                │              │
     ▼             ▼                ▼              ▼
is_git_repo    工作目录切换       git init执行     初始提交生成
@subprocess    os.chdir()         git add .        "Initial commit"
     │             │                │              │
     ▼             ▼                ▼              ▼
.git目录检查   项目根目录定位    文件暂存处理      版本历史建立
Path检查       project_path      staging area     commit hash
     │             │                │              │
     ▼             ▼                ▼              ▼
仓库状态判断 ──→ 路径状态管理 ──→ 变更跟踪 ──→ 分支管理准备
现有repo检测   cwd恢复机制       文件变更状态     feature分支
```

## 错误处理与状态管理数据流向
```
异常捕获处理 ──→ StepTracker ──→ 状态渲染更新 ──→ 用户界面反馈
     │              │               │               │
     ▼              ▼               ▼               ▼
try/except块    步骤状态跟踪    Rich组件渲染     控制台输出
@各函数级别     pending/running  Tree/Panel      console.print
     │              │               │               │
     ▼              ▼               ▼               ▼
错误分类处理    进度状态更新    实时界面刷新     错误信息展示
网络/文件/权限  complete/error   Live refresh    红色错误提示
     │              │               │               │
     ▼              ▼               ▼               ▼
清理资源释放 ──→ 状态持久化 ──→ 最终渲染 ──→ 程序退出码
临时文件删除    tracker记录     static render   typer.Exit
```

## 模板文件路径解析数据流向
```
模板选择参数 ──→ 路径构建逻辑 ──→ 文件系统操作 ──→ 内容处理流程
     │              │               │               │
     ▼              ▼               ▼               ▼
ai_assistant     模板路径拼接    文件存在性检查   复制/移动操作
script_type      template pattern   Path.exists    shutil.copy2
     │              │               │               │
     ▼              ▼               ▼               ▼
GitHub asset筛选  文件名匹配算法   目录结构验证   权限位设置
zip包选择        pattern matching  nested dir     chmod操作
     │              │               │               │
     ▼              ▼               ▼               ▼
下载URL构建 ──→ 本地路径映射 ──→ 文件层次处理 ──→ 脚本执行权限
browser_download  project_path     flatten logic   ensure_executable
```